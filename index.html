<script>
  let db = {};
  db.repos = {};
  db.packages = {};
  async function load(repo) {
    let meta = await (await fetch(repo + "/meta.json")).json();
    if (meta.id && meta.name && meta.version) {
      db.repos[meta.id + ""] = {};
      db.repos[meta.id + ""].name = meta.name + "";
      db.repos[meta.id + ""].version = meta.version + "";
      db.repos[meta.id + ""].description = meta.description + "" || "";
      db.repos[meta.id + ""].icon =
        meta.icon + "" || "https://via.placeholder.com/57";
      let packages = await (await fetch(repo + "/packages.json")).json();
      for (let package of packages) {
        db.packages[package.id + ""] = {};
        db.packages[package.id + ""].id = package.id + "";
        db.packages[package.id + ""].version = package.version + "";
        db.packages[package.id + ""].name = package.name + "";
        db.packages[package.id + ""].maintainer =
          package.maintainer || package.author;
        db.packages[package.id + ""].author =
          package.author || {
          
        };
        db.packages[package.id + ""].description =
          package.description + "" || "";
        db.packages[package.id + ""].depends = package.depends || [];
        db.packages[package.id + ""].depiction = package.depiction+"" || false;
        
        if(!db.packages[package.id + ""].depiction){
          db.packages[package.id + ""].depiction="https://papercuts.glitch.me/fallback-depiction.html#"+encodeURIComponent(JSON.stringify(db.packages[package.id + ""]))
        }
      }
    }
  }
  load("https://papercuts-repo.glitch.me");
</script>
