<script>
  let db = {};
  db.repos = {};
  db.packages = [];
  async function load(repo) {
    let meta = await (await fetch(repo + "/meta.json")).json();
    if (meta.id && meta.name && meta.version) {
      db.repos[meta.id + ""] = {};
      db.repos[meta.id + ""].name = meta.name + "";
      db.repos[meta.id + ""].version = meta.version + "";
      db.repos[meta.id + ""].description = meta.description + "" || "";
      db.repos[meta.id + ""].icon =
        meta.icon + "" || "https://via.placeholder.com/57";
      let packages = await (await fetch(repo + "/packages.json")).json();
      for (let package of packages) {
        let dbpackage = {};
        dbpackage.id = package.id + "";
        dbpackage.version = package.version + "";
        dbpackage.name = package.name + "";
        dbpackage.link = package.link + "";
        dbpackage.arch = package.arch + ""||"universal";
        dbpackage.author = package.author || {
          name: "No Contact",
          link: "about:blank"
        };
        dbpackage.maintainer =
          package.maintainer || dbpackage.author;
        dbpackage.description =
          package.description + "" || "";
        dbpackage.depends = package.depends || [];
        dbpackage.depiction =
          package.depiction + "" || false;

        if (!dbpackage.depiction) {
          dbpackage.depiction =
            "https://papercuts.glitch.me/fallback-depiction.html#" +
            encodeURIComponent(JSON.stringify(dbpackage));
        }
        db.packages.push(dbpackage)
      }
    }
  }
  load("https://papercuts-repo.glitch.me");
</script>
